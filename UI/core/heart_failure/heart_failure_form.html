<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dự Đoán Suy Tim</title>
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>
    <body class="bg-light">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="card shadow rounded-4 border-0">
                        <div class="card-body p-5">
                            <h2 class="text-center mb-4">
                                Dự Đoán Nguy Cơ Suy Tim
                            </h2>
                            <form id="heartForm">
                                <div class="row g-4">
                                    <div class="col-md-4">
                                        <label class="form-label">Tuổi</label>
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="Age"
                                            min="1"
                                            max="120"
                                            value="45"
                                            required
                                        />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Giới tính</label
                                        >
                                        <select class="form-select" name="Sex">
                                            <option value="M">Nam</option>
                                            <option value="F">Nữ</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Kiểu đau ngực</label
                                        >
                                        <select
                                            class="form-select"
                                            name="ChestPainType"
                                        >
                                            <option value="TA">TA</option>
                                            <option value="ATA">ATA</option>
                                            <option value="NAP">NAP</option>
                                            <option value="ASY">ASY</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Huyết áp nghỉ (mmHg)</label
                                        >
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="RestingBP"
                                            min="60"
                                            max="200"
                                            value="120"
                                            required
                                        />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Cholesterol</label
                                        >
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="Cholesterol"
                                            min="50"
                                            max="400"
                                            value="180"
                                            required
                                        />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Fasting Blood Sugar</label
                                        >
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="FastingBS"
                                            min="0"
                                            max="1"
                                            value="0"
                                            required
                                        />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >ECG nghỉ</label
                                        >
                                        <select
                                            class="form-select"
                                            name="RestingECG"
                                        >
                                            <option value="Normal">
                                                Normal
                                            </option>
                                            <option value="ST">ST</option>
                                            <option value="LVH">LVH</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Nhịp tim tối đa (MaxHR)</label
                                        >
                                        <input
                                            type="number"
                                            class="form-control"
                                            name="MaxHR"
                                            min="60"
                                            max="220"
                                            value="150"
                                            required
                                        />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Đau thắt ngực khi gắng sức</label
                                        >
                                        <select
                                            class="form-select"
                                            name="ExerciseAngina"
                                        >
                                            <option value="Y">Có</option>
                                            <option value="N">Không</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >Oldpeak</label
                                        >
                                        <input
                                            type="number"
                                            step="0.1"
                                            class="form-control"
                                            name="Oldpeak"
                                            min="0"
                                            max="10"
                                            value="1.5"
                                            required
                                        />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label"
                                            >ST Slope</label
                                        >
                                        <select
                                            class="form-select"
                                            name="ST_Slope"
                                        >
                                            <option value="Up">Up</option>
                                            <option value="Flat">Flat</option>
                                            <option value="Down">Down</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="text-center mt-5">
                                    <button
                                        type="submit"
                                        class="btn btn-primary btn-lg"
                                    >
                                        Dự đoán nguy cơ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <p class="text-center text-muted mt-3 small">
                        © 2025 Hệ thống hỗ trợ chẩn đoán y tế
                    </p>
                </div>
            </div>
        </div>

        <script>
            document
                .getElementById("heartForm")
                .addEventListener("submit", async function (e) {
                    e.preventDefault();

                    const form = e.target;
                    const data = {
                        Age: parseInt(form.Age.value),
                        Sex: form.Sex.value,
                        ChestPainType: form.ChestPainType.value,
                        RestingBP: parseInt(form.RestingBP.value),
                        Cholesterol: parseInt(form.Cholesterol.value),
                        FastingBS: parseInt(form.FastingBS.value),
                        RestingECG: form.RestingECG.value,
                        MaxHR: parseInt(form.MaxHR.value),
                        ExerciseAngina: form.ExerciseAngina.value,
                        Oldpeak: parseFloat(form.Oldpeak.value),
                        ST_Slope: form.ST_Slope.value,
                    };

                    try {
                        const res = await fetch(
                            "http://localhost:8000/predict/heart_failure",
                            {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                    Accept: "application/json",
                                },
                                body: JSON.stringify(data),
                            }
                        );

                        const result = await res.json();
                        const query = new URLSearchParams({
                            prediction: result.prediction,
                            message: result.message,
                        }).toString();
                        window.location.href = "heart_result.html?" + query;
                    } catch (error) {
                        alert("Có lỗi xảy ra khi gọi API.");
                        console.error(error);
                    }
                });
        </script>
    </body>
</html>

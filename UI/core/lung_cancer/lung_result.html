<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Kết Quả Chẩn Đoán | SmartClinic.AI</title>
        <link
            rel="icon"
            type="image/x-icon"
            href="../static/home/images/logoicon.webp"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Auth Guard Script -->
        <script src="../auth/auth-guard.js"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: "#3b82f6",
                            secondary: "#64748b",
                            success: "#10b981",
                            warning: "#f59e0b",
                            danger: "#ef4444",
                            info: "#06b6d4",
                        },
                    },
                },
            };
        </script>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap");

            :root {
                --primary-color: #3b82f6;
                --secondary-color: #64748b;
                --success-color: #10b981;
                --warning-color: #f59e0b;
                --danger-color: #ef4444;
                --info-color: #06b6d4;
                --light-color: #f8fafc;
                --dark-color: #1e293b;
            }

            body {
                font-family: "Roboto", sans-serif;
                background-color: var(--light-color);
            }

            .result-card {
                border: none;
                border-radius: 16px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
                overflow: hidden;
                transition: all 0.3s ease;
            }

            .result-card:hover {
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
                transform: translateY(-5px);
            }

            .icon-wrapper {
                width: 70px;
                height: 70px;
                border-radius: 50%;
                background-color: rgba(59, 130, 246, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 1.5rem;
            }

            .result-badge {
                display: inline-block;
                font-size: 1.1rem;
                padding: 0.5rem 1.5rem;
                border-radius: 50px;
                font-weight: 500;
                margin-bottom: 1rem;
            }

            .result-badge.low {
                background-color: rgba(16, 185, 129, 0.15);
                color: var(--success-color);
            }

            .result-badge.moderate {
                background-color: rgba(245, 158, 11, 0.15);
                color: var(--warning-color);
            }

            .result-badge.high {
                background-color: rgba(239, 68, 68, 0.15);
                color: var(--danger-color);
            }

            .result-title {
                font-size: 1.5rem;
                font-weight: 700;
                margin-bottom: 1rem;
            }

            .result-description {
                color: var(--secondary-color);
                margin-bottom: 2rem;
            }

            .recommendation-card {
                border: 1px solid rgba(0, 0, 0, 0.05);
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 1rem;
                transition: all 0.3s ease;
            }

            .recommendation-card:hover {
                background-color: rgba(59, 130, 246, 0.02);
                transform: translateY(-2px);
            }

            .recommendation-icon {
                width: 50px;
                height: 50px;
                border-radius: 12px;
                background-color: rgba(59, 130, 246, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 1rem;
            }

            .btn-primary {
                background-color: var(--primary-color);
                border: none;
                border-radius: 10px;
                padding: 12px 30px;
                font-weight: 500;
                transition: all 0.3s ease;
            }

            .btn-primary:hover {
                background-color: #2563eb;
                transform: translateY(-2px);
                box-shadow: 0 6px 15px rgba(59, 130, 246, 0.3);
            }

            .btn-outline-primary {
                border-color: var(--primary-color);
                color: var(--primary-color);
                border-radius: 10px;
                padding: 12px 30px;
                font-weight: 500;
                transition: all 0.3s ease;
            }

            .btn-outline-primary:hover {
                background-color: var(--primary-color);
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 6px 15px rgba(59, 130, 246, 0.2);
            }

            .risk-level {
                width: 100%;
                height: 12px;
                background-color: #e2e8f0;
                border-radius: 6px;
                margin: 1.5rem 0;
                position: relative;
                overflow: hidden;
            }

            .risk-indicator {
                height: 100%;
                border-radius: 6px;
                position: absolute;
                top: 0;
                left: 0;
                transition: width 1.5s ease;
            }

            .risk-indicator.low {
                background-color: var(--success-color);
                width: 0%; /* Will be set by JS */
            }

            .risk-indicator.moderate {
                background-color: var(--warning-color);
                width: 0%; /* Will be set by JS */
            }

            .risk-indicator.high {
                background-color: var(--danger-color);
                width: 0%; /* Will be set by JS */
            }

            .risk-scale {
                display: flex;
                justify-content: space-between;
                margin-bottom: 0.5rem;
            }

            .risk-label {
                font-size: 0.85rem;
                color: var(--secondary-color);
            }

            /* Print styles */
            @media print {
                .no-print {
                    display: none !important;
                }
                
                body {
                    background-color: white !important;
                }
                
                .result-card {
                    box-shadow: none !important;
                    border: 1px solid #e2e8f0 !important;
                }
            }
        </style>
    </head>

    <body>
        <!-- Nhúng topbar mới -->
        <!--#include file="../../..../static/utils/home/topbar.html" -->

        <main class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <!-- Page header -->
                    <div class="text-center mb-5">
                        <div class="icon-wrapper mb-4">
                            <i class="fas fa-lungs fa-2x text-primary"></i>
                        </div>
                        <h1 class="fw-bold">Kết Quả Đánh Giá Nguy Cơ Ung Thư Phổi</h1>
                        <p class="text-secondary lead">
                            Dựa trên thông tin bạn cung cấp, hệ thống AI của chúng tôi đã phân tích và đưa ra kết quả
                        </p>
                        <!-- Admin only alert -->
                        <div class="alert alert-info d-flex align-items-center rounded-3 p-3 mb-4 mx-auto" style="max-width: 600px;">
                            <i class="fas fa-lock me-3 text-info"></i>
                            <div>
                                Chức năng này chỉ dành cho quản trị viên. Bạn đang truy cập với quyền admin.
                            </div>
                        </div>
                    </div>

                    <!-- Result card -->
                    <div class="card result-card mb-5">
                        <div class="card-body p-4 p-lg-5">
                            <div class="text-center mb-4">
                                <div class="risk-badge" id="riskBadge">Đang phân tích...</div>
                                <h2 class="result-title" id="resultTitle">Đang tải kết quả...</h2>
                                <p class="result-description" id="resultDescription">
                                    Dựa trên thông tin bạn cung cấp, đây là đánh giá chi tiết về nguy cơ ung thư phổi.
                                </p>

                                <!-- Risk level bar -->
                                <div class="risk-scale">
                                    <span class="risk-label">Thấp</span>
                                    <span class="risk-label">Trung bình</span>
                                    <span class="risk-label">Cao</span>
                                </div>
                                <div class="risk-level">
                                    <div class="risk-indicator" id="riskIndicator"></div>
                                </div>
                            </div>

                            <!-- Recommendations section -->
                            <div class="mt-5">
                                <h4 class="fw-bold mb-4">Khuyến nghị và bước tiếp theo</h4>
                                
                                <div class="recommendation-card d-flex align-items-start">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-stethoscope text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold">Tham khảo ý kiến bác sĩ</h5>
                                        <p class="text-secondary mb-0">
                                            Kết quả này chỉ mang tính tham khảo. Vui lòng tham khảo ý kiến bác sĩ chuyên khoa để được tư vấn chi tiết và phù hợp với tình trạng sức khỏe cá nhân.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="recommendation-card d-flex align-items-start">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-lungs text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold">Kiểm tra sức khỏe định kỳ</h5>
                                        <p class="text-secondary mb-0">
                                            Việc thực hiện kiểm tra sức khỏe định kỳ, đặc biệt là chụp X-quang ngực hoặc CT ngực liều thấp đối với nhóm có nguy cơ cao sẽ giúp phát hiện sớm bệnh lý.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="recommendation-card d-flex align-items-start" id="smokingRecommendation">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-smoking-ban text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold">Bỏ thuốc lá</h5>
                                        <p class="text-secondary mb-0">
                                            Hút thuốc là yếu tố nguy cơ hàng đầu của ung thư phổi. Bỏ thuốc lá sẽ giảm đáng kể nguy cơ mắc bệnh, ngay cả khi đã hút thuốc trong nhiều năm.
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="recommendation-card d-flex align-items-start">
                                    <div class="recommendation-icon">
                                        <i class="fas fa-heartbeat text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold">Lối sống lành mạnh</h5>
                                        <p class="text-secondary mb-0">
                                            Duy trì chế độ ăn uống cân bằng, tăng cường rau xanh và trái cây, tập thể dục đều đặn và hạn chế tiếp xúc với các chất độc hại như khói, hóa chất công nghiệp.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-5 no-print">
                                <a href="lung_cancer_form.html" class="btn btn-outline-primary">
                                    <i class="fas fa-redo me-2"></i> Đánh giá lại
                                </a>
                                <button onclick="window.print()" class="btn btn-primary">
                                    <i class="fas fa-print me-2"></i> In kết quả
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Disclaimer -->
                    <div class="alert alert-info d-flex align-items-center rounded-3 p-3 mb-4">
                        <i class="fas fa-info-circle fs-4 me-3 text-info"></i>
                        <div>
                            <strong>Lưu ý quan trọng:</strong> Kết quả này chỉ mang tính tham khảo và không thay thế cho chẩn đoán y khoa chính thức từ bác sĩ. Vui lòng tham khảo ý kiến chuyên gia y tế để được tư vấn chính xác.
                        </div>
                    </div>

                    <p class="text-center text-muted small">
                        © 2025 SmartClinic.AI - Hệ thống hỗ trợ chẩn đoán y tế thông minh
                    </p>
                </div>
            </div>
        </main>

        <!-- Nhúng footer mới -->
        <!--#include file="../../..../static/utils/home/footer.html" -->

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Kiểm tra phân quyền khi trang tải
                if (!window.AuthGuard.isAdmin()) {
                    window.location.href = '/core/auth/login.html?redirect=' + encodeURIComponent(window.location.pathname) + '&unauthorized=true';
                    return;
                }
                
                // Parse URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const prediction = urlParams.get('prediction');
                const message = urlParams.get('message');
                
                if (!prediction || !message) {
                    // Redirect back to form if no results
                    window.location.href = 'lung_cancer_form.html';
                    return;
                }
                
                const riskBadge = document.getElementById('riskBadge');
                const resultTitle = document.getElementById('resultTitle');
                const resultDescription = document.getElementById('resultDescription');
                const riskIndicator = document.getElementById('riskIndicator');
                const smokingRecommendation = document.getElementById('smokingRecommendation');
                
                // Update UI based on prediction
                if (prediction === 'Low') {
                    riskBadge.textContent = 'Nguy cơ thấp';
                    riskBadge.className = 'result-badge low';
                    resultTitle.textContent = 'Nguy cơ ung thư phổi thấp';
                    riskIndicator.className = 'risk-indicator low';
                    setTimeout(() => { riskIndicator.style.width = '20%'; }, 100);
                } else if (prediction === 'Medium') {
                    riskBadge.textContent = 'Nguy cơ trung bình';
                    riskBadge.className = 'result-badge moderate';
                    resultTitle.textContent = 'Nguy cơ ung thư phổi trung bình';
                    riskIndicator.className = 'risk-indicator moderate';
                    setTimeout(() => { riskIndicator.style.width = '60%'; }, 100);
                } else if (prediction === 'High') {
                    riskBadge.textContent = 'Nguy cơ cao';
                    riskBadge.className = 'result-badge high';
                    resultTitle.textContent = 'Nguy cơ ung thư phổi cao';
                    riskIndicator.className = 'risk-indicator high';
                    setTimeout(() => { riskIndicator.style.width = '90%'; }, 100);
                }
                
                // Set message
                resultDescription.textContent = decodeURIComponent(message);
            });
        </script>
    </body>
</html>

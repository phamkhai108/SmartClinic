<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dự Đoán Bệnh Qua Hình Ảnh</title>
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
            rel="stylesheet"
        />
        <style>
            .custom-file-upload {
                cursor: pointer;
            }

            .result-box {
                display: none;
            }
        </style>
    </head>
    <body class="bg-light">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow border-0 rounded-4">
                        <div class="card-body p-4 p-md-5">
                            <div class="text-center mb-4">
                                <div class="mb-3">
                                    <i
                                        class="fas fa-notes-medical fa-3x text-primary"
                                    ></i>
                                </div>
                                <h1 class="h3 fw-bold">Phân loại khối U não</h1>
                                <p class="text-muted">
                                    Tải lên hình ảnh y tế để nhận kết quả phân
                                    tích chính xác
                                </p>
                            </div>

                            <!-- Khu vực upload ảnh -->
                            <div
                                class="border border-2 border-dashed rounded-3 p-4 text-center position-relative mb-4"
                                style="min-height: 250px"
                                id="upload-area"
                            >
                                <div class="py-4">
                                    <i
                                        class="fas fa-cloud-upload-alt fa-4x text-primary mb-3"
                                    ></i>
                                    <h5 class="mb-3">
                                        Tải lên hình ảnh của bạn
                                    </h5>
                                    <div
                                        class="d-flex justify-content-center gap-2 mb-3"
                                    >
                                        <span class="badge bg-light text-dark"
                                            ><i
                                                class="far fa-file-image me-1"
                                            ></i>
                                            JPG</span
                                        >
                                        <span class="badge bg-light text-dark"
                                            ><i
                                                class="far fa-file-image me-1"
                                            ></i>
                                            PNG</span
                                        >
                                        <span class="badge bg-light text-dark"
                                            ><i class="fas fa-x-ray me-1"></i>
                                            DICOM</span
                                        >
                                    </div>
                                    <p class="text-muted small">
                                        Kéo và thả hoặc nhấp để chọn tệp
                                    </p>
                                </div>
                                <input
                                    type="file"
                                    id="imageInput"
                                    class="opacity-0 position-absolute top-0 start-0 w-100 h-100"
                                    accept="image/*"
                                    style="cursor: pointer"
                                />
                            </div>

                            <!-- Các nút chức năng -->
                            <div class="d-grid gap-2">
                                <button
                                    class="btn btn-primary btn-lg py-3"
                                    id="predictBtn"
                                >
                                    <i class="fas fa-stethoscope me-2"></i>Dự
                                    đoán bệnh
                                </button>
                                <button
                                    class="btn btn-light"
                                    onclick="resetForm()"
                                >
                                    <i class="fas fa-redo me-2"></i>Làm mới
                                </button>
                            </div>

                            <!-- Kết quả dự đoán -->
                            <div class="mt-4 result-box" id="resultBox">
                                <div
                                    class="alert alert-success d-flex"
                                    role="alert"
                                >
                                    <i
                                        class="fas fa-check-circle fa-lg me-3 my-auto text-success"
                                    ></i>
                                    <div>
                                        <h5 class="mb-1">Kết quả dự đoán:</h5>
                                        <p class="mb-0">
                                            <strong>Phân loại:</strong>
                                            <span id="predictedClass">...</span>
                                        </p>
                                        <p class="mb-0">
                                            <strong>Độ tin cậy:</strong>
                                            <span id="confidence">...</span>%
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Thông báo lưu ý -->
                            <div class="mt-4">
                                <div
                                    class="alert alert-info d-flex"
                                    role="alert"
                                >
                                    <i
                                        class="fas fa-info-circle fa-lg me-3 my-auto"
                                    ></i>
                                    <div>
                                        <strong>Lưu ý:</strong> Kết quả dự đoán
                                        chỉ mang tính tham khảo. Vui lòng tham
                                        khảo ý kiến bác sĩ chuyên khoa để được
                                        chẩn đoán chính xác.
                                    </div>
                                </div>
                            </div>

                            <!-- Chân trang nhỏ -->
                            <div class="text-center text-muted small mt-4">
                                <div
                                    class="d-flex justify-content-center gap-3 mb-2"
                                >
                                    <span
                                        ><i class="fas fa-shield-alt me-1"></i>
                                        Bảo mật</span
                                    >
                                    <span
                                        ><i class="fas fa-bolt me-1"></i> Nhanh
                                        chóng</span
                                    >
                                    <span
                                        ><i class="fas fa-chart-line me-1"></i>
                                        Chính xác</span
                                    >
                                </div>
                                <p>© 2025 Hệ thống hỗ trợ chẩn đoán y tế</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- JavaScript Logic -->
        <script>
            const predictBtn = document.getElementById("predictBtn");
            const imageInput = document.getElementById("imageInput");
            const resultBox = document.getElementById("resultBox");
            const predictedClassSpan =
                document.getElementById("predictedClass");
            const confidenceSpan = document.getElementById("confidence");

            predictBtn.addEventListener("click", async () => {
                const file = imageInput.files[0];

                if (!file) {
                    alert("Vui lòng chọn một hình ảnh để dự đoán.");
                    return;
                }

                const formData = new FormData();
                formData.append("file", file);

                try {
                    const response = await fetch(
                        "http://localhost:8000/brain/predict_tumor",
                        {
                            method: "POST",
                            body: formData,
                        }
                    );

                    if (!response.ok) {
                        throw new Error("Lỗi khi gửi yêu cầu tới API.");
                    }

                    const data = await response.json();

                    predictedClassSpan.textContent = data.predicted_class;
                    confidenceSpan.textContent = data.confidence;
                    resultBox.style.display = "block";
                } catch (error) {
                    alert("Đã xảy ra lỗi: " + error.message);
                    resultBox.style.display = "none";
                }
            });

            function resetForm() {
                imageInput.value = "";
                resultBox.style.display = "none";
            }
        </script>
    </body>
</html>
